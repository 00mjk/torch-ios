#!/bin/bash

PREFIX=@Torch_INSTALL_BIN@

IMPORTF="function import(package) require(package) for k,v in pairs(_G[package]) do if not _G[k] then _G[k] = v end end end"
IMPORT_TORCH="import 'torch'"
IMPORT_LAB="import 'lab'"

PROMPT="_PROMPT='torch> ' _PROMPT2=' ... > '"

COPYRIGHT="print 'Torch 7.0  Copyright (C) 2001-2011 Idiap, NEC Labs, NYU'"

INIT="$COPYRIGHT $PROMPT $IMPORTF $IMPORT_TORCH $IMPORT_LAB"

if [ -f $PREFIX/qlua ]; 
then 
    if [ $DISPLAY ];
    then
        echo "Try the IDE: torch -ide"
        $PREFIX/qlua -e "$INIT" -i $*;
    else
        echo "Unable to connect X11 server (disabling graphics)"
        $PREFIX/qlua -nographics -e "$INIT" -i $*;
    fi
else 
    echo "Install Qt4 and rebuild Torch7 for graphics capability"
    $PREFIX/lua -e "$INIT" -i $*;
fi
